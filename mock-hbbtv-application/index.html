<!DOCTYPE html PUBLIC "-//HbbTV//1.1.1//EN" "http://www.hbbtv.org/dtd/HbbTV-1.1.1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title>Mock HbbTv app</title>
  <meta http-equiv="Content-Type" content="application/vnd.hbbtv.xml+xhtml; utf-8" />
  <style>
    body {
      background-color: transparent;
      width: 1280px;
      height: 720px;
      overflow: hidden;
      font-family: "Tiresias", sans-serif;
    }

    object#video {
      position: absolute;
      top: 0px;
      left: 0px;
      width: 1280px;
      height: 720px;
    }

    object#applicationManager {
      position: absolute;
      left: 0px;
      top: 0px;
      width: 0px;
      height: 0px;
    }

    #redbutton {
      position: absolute;
      bottom: 36px;
      right: 36px;
      width: 235px;
      height: 110px;
      background-color: #ccccccdd;
      border-radius: 10px;
      padding: 10px;
    }

    .redbutton__menu-item {
      margin-bottom: 10px;
    }

    .redbutton__menu-item-button-icon {
      float: left;
      display: block;
      width: 26px;
      height: 16px;
      margin-right: 10px;
      border-radius: 2px;
    }
  </style>
  <script type="text/javascript">
    //<![CDATA[
    var currentChannel = 9999;

    function initKeyCodes() {
      window['KeyEvent'] = window['KeyEvent'] || {};
      KeyEvent['VK_RED'] = KeyEvent.VK_RED || window.VK_RED || 403;
      KeyEvent['VK_GREEN'] = KeyEvent.VK_GREEN || window.VK_GREEN || 404;
      KeyEvent['VK_YELLOW'] = KeyEvent.VK_YELLOW || window.VK_YELLOW || 405;
      KeyEvent['VK_BLUE'] = KeyEvent.VK_BLUE || window.VK_BLUE || 406;
    }

    function keyHandler(event) {
      switch (event.keyCode) {
        case KeyEvent.VK_RED:
          window.__hbb_tracking_tgt.stop(function () {
            console.log('Tracking stopped');
          });
          break;
        case KeyEvent.VK_GREEN:
          window.__hbb_tracking_tgt.start(function () {
            console.log('Tracking started');
          }, null, 'manual-start');
          break;
        case KeyEvent.VK_YELLOW:
          var channelToSwitchTo = currentChannel === 9999 ? 9998 : 9999;
          var contextId = channelToSwitchTo === 9999 ? "context-9999" : "context-9998";
          window.__hbb_tracking_tgt.switchChannel(channelToSwitchTo, 1, 1, function () {
            console.log('Channel switched to ' + channelToSwitchTo);
            currentChannel = channelToSwitchTo;
          }, null, contextId);
          break;
        case KeyEvent.VK_BLUE:
          setTimeout(function () {
            location.reload();
          }, 300);
          break;
        default:
          break;
      }
    }

    function init() {
      var mgr = document.getElementById('oipfAppMngr');
      var app = mgr && mgr.getOwnerApplication && mgr.getOwnerApplication(document);
      var keyset = app && app.privateData.keyset;
      keyset && keyset.setValue(keyset.RED | keyset.GREEN | keyset.YELLOW | keyset.BLUE);

      initKeyCodes();
      document.addEventListener('keydown', keyHandler);
    }
    //]]>
  </script>
</head>

<body onload="init()">
  <object id='video' type='video/broadcast' fullscreen='true' width='1280' height='720'
    style='position:absolute; top: 0px; left: 0px; width: 1280px; height: 720px;'></object>
  <div style='visibility: hidden; width: 0; height: 0; position: absolute;'>
    <object id='oipfAppMngr' type='application/oipfApplicationManager'></object>
    <object id='oipfCfg' type='application/oipfConfiguration'></object>
  </div>

  <div id="redbutton">
    <div class="redbutton__menu-item">
      <div class="redbutton__menu-item-button-icon" style="background-color: #c43939;"></div>
      <div>stop</div>
    </div>
    <div class="redbutton__menu-item">
      <div class="redbutton__menu-item-button-icon" style="background-color: #3FCD7F;"></div>
      <div>start</div>
    </div>
    <div class="redbutton__menu-item">
      <div class="redbutton__menu-item-button-icon" style="background-color: #F3D07C;"></div>
      <div>switchChannel</div>
    </div>
    <div class="redbutton__menu-item">
      <div class="redbutton__menu-item-button-icon" style="background-color: #3993D9;"></div>
      <div>reload</div>
    </div>
  </div>

  <script type="text/javascript">
    //<![CDATA[
    (function (a) {
      try {
        a.type = 'text/javascript';
        a.src = 'http://localhost:3000/' + currentChannel + '/tracking.js?r=1&d=1&t=' + new Date().getTime() + '&i=context-9999';
        document.getElementsByTagName('head')[0].appendChild(a);
      } catch (b) {}
    })(document.createElement('script'));
    //]]>
  </script>
</body>

</html>
